# æ²¹ä»·æ–°é—»åˆ†æç³»ç»Ÿ

åŸºäºå¤šAgentæ¶æ„çš„æ²¹ä»·æ–°é—»æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œè‡ªåŠ¨åˆ¤æ–­æ–°é—»ä¸æ²¹ä»·çš„å…³è”æ€§ï¼Œè¯„ä¼°å½±å“åŠ›åº¦ï¼Œå¹¶ç”Ÿæˆç»¼åˆé£é™©æŠ¥å‘Šã€‚


## é¡¹ç›®ç»“æ„

```
textanalysis/
â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ crawler.py                 # ç½‘é¡µçˆ¬è™«
â”œâ”€â”€ data_loader.py             # æ•°æ®åŠ è½½å™¨
â”œâ”€â”€ llm_client.py              # LLMå®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ agents/                    # Agentæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_agent.py          # AgentåŸºç±»
â”‚   â”œâ”€â”€ relevance_agent.py     # Agent1: æ²¹ä»·å…³è”éªŒè¯
â”‚   â”œâ”€â”€ impact_agent.py        # Agent2: å½±å“åŠ›åº¦è¯„åˆ†
â”‚   â””â”€â”€ causality_agent.py     # Agent3: å› æœæ ¡éªŒ
â”‚
â”œâ”€â”€ database/                  # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py              # ORMæ¨¡å‹
â”‚   â””â”€â”€ repository.py          # æ•°æ®åº“æ“ä½œ
â”‚
â”œâ”€â”€ workflow/                  # å·¥ä½œæµå¼•æ“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ nodes.py               # å·¥ä½œæµèŠ‚ç‚¹
â”‚   â””â”€â”€ pipeline.py            # æµæ°´çº¿ç®¡ç†
â”‚
â”œâ”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ aggregator.py          # æ—¥åº¦èšåˆ
â”‚   â””â”€â”€ report_generator.py    # æŠ¥å‘Šç”Ÿæˆ
â”‚
â”œâ”€â”€ data/                      # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ input.csv              # è¾“å…¥æ•°æ®
â”‚   â””â”€â”€ oil_events.db          # SQLiteæ•°æ®åº“
â”‚
â””â”€â”€ output/                    # è¾“å‡ºç›®å½•
```

## Agentè¯´æ˜

### Agent1: å…³è”æ€§éªŒè¯ (RelevanceAgent)

åˆ¤æ–­æ–°é—»æ˜¯å¦ä¸å›½é™…æ²¹ä»·ç›´æ¥ç›¸å…³ã€‚

**è¾“å‡º:**
- `is_oil_related`: æ˜¯å¦ç›¸å…³ (bool)
- `confidence`: ç½®ä¿¡åº¦ (0-1)
- `reason`: åˆ¤æ–­åŸå› 

### Agent2: å½±å“åŠ›åº¦è¯„åˆ† (ImpactAgent)

è¯„ä¼°æ²¹ä»·ç›¸å…³æ–°é—»çš„å½±å“æ–¹å‘å’ŒåŠ›åº¦ã€‚

**è¾“å‡º:**
- `direction`: å½±å“æ–¹å‘ (åˆ©å¥½/åˆ©ç©º/ä¸­æ€§)
- `score`: å½±å“è¯„åˆ† (-10 åˆ° +10)
- `factors`: å½±å“å› ç´ åˆ—è¡¨
- `time_horizon`: å½±å“æ—¶æ•ˆ (çŸ­æœŸ/ä¸­æœŸ/é•¿æœŸ)

### Agent3: å› æœæ ¡éªŒ (CausalityAgent)

å¯¹å½±å“è¯„ä¼°è¿›è¡Œå› æœé“¾éªŒè¯ï¼Œç¡®ä¿åˆ†æé€»è¾‘ä¸¥å¯†ã€‚

**è¾“å‡º:**
- `verified`: å› æœé“¾æ˜¯å¦åˆç† (bool)
- `adjusted_score`: è°ƒæ•´åè¯„åˆ†
- `causal_chain`: å› æœé“¾æ¡
- `warnings`: é£é™©æç¤º

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install pandas requests beautifulsoup4 sqlalchemy
```

### 2. é…ç½®

ç¼–è¾‘ `config.py` è®¾ç½®ä½ çš„LLM APIå¯†é’¥ï¼š

```python
LLM_API_KEY = "your-api-key"
LLM_BASE_URL = "https://api.deepseek.com/v1"
LLM_MODEL = "deepseek-chat"
```

æˆ–é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼š

```bash
export LLM_API_KEY="your-api-key"
export LLM_BASE_URL="https://api.deepseek.com/v1"
export LLM_MODEL="deepseek-chat"
```

### 3. å‡†å¤‡è¾“å…¥æ•°æ®

åœ¨ `data/input.csv` ä¸­å‡†å¤‡æ–°é—»æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```csv
id,title,date,category,url
1,æ–°é—»æ ‡é¢˜,2024-01-01,åˆ†ç±»,https://example.com/news/1
```

### 4. è¿è¡Œ

```bash
python main.py
```

## è¾“å‡ºè¯´æ˜

### æ–‡æœ¬æŠ¥å‘Šç¤ºä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“Š æ²¹ä»·å½±å“æ—¥åº¦æŠ¥å‘Š                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  æ—¥æœŸ: 2024-01-28                                            
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ ç»¼åˆè¯„ä¼°                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç»¼åˆè¯„åˆ†: +3.50                                            â”‚
â”‚   é£é™©ç­‰çº§: ã€è½»åº¦åˆ©å¥½ã€‘                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®åº“è¡¨ç»“æ„

**oil_events**: å­˜å‚¨æ¯æ¡åˆ†æè¿‡çš„äº‹ä»¶
- æ–°é—»åŸºç¡€ä¿¡æ¯
- Agent1/2/3çš„åˆ†æç»“æœ
- åŸå§‹å†…å®¹å’Œå…ƒæ•°æ®

**daily_risk_summary**: å­˜å‚¨æ¯æ—¥æ±‡æ€»
- ç»¼åˆè¯„åˆ†å’Œé£é™©ç­‰çº§
- å„æ–¹å‘äº‹ä»¶ç»Ÿè®¡
- å…³é”®äº‹ä»¶åˆ—è¡¨

## é…ç½®é€‰é¡¹

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `RELEVANCE_CONFIDENCE_THRESHOLD` | å…³è”æ€§ç½®ä¿¡åº¦é˜ˆå€¼ | 0.6 |
| `SIMILAR_EVENTS_DAYS` | æŸ¥è¯¢å†å²åŒç±»äº‹ä»¶å¤©æ•° | 30 |
| `SIMILAR_EVENTS_LIMIT` | è¿”å›åŒç±»äº‹ä»¶æ•°é‡ | 5 |
| `MAX_CONTENT_LENGTH` | å‘é€LLMçš„æœ€å¤§å†…å®¹é•¿åº¦ | 4000 |
| `WORKFLOW_RETRY_COUNT` | èŠ‚ç‚¹å¤±è´¥é‡è¯•æ¬¡æ•° | 2 |

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„Agent

1. åœ¨ `agents/` ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶
2. ç»§æ‰¿ `BaseAgent` ç±»
3. å®ç° `execute()` å’Œ `build_prompt()` æ–¹æ³•
4. åœ¨ `main.py` ä¸­æ³¨å†Œåˆ°å·¥ä½œæµ

### è‡ªå®šä¹‰å·¥ä½œæµèŠ‚ç‚¹

```python
from workflow import WorkflowNode, NodeResult
from workflow.nodes import NodeStatus

node = WorkflowNode(
    name="my_node",
    handler=my_handler_function,
    description="è‡ªå®šä¹‰èŠ‚ç‚¹",
    next_node="next_node_name"
)

pipeline.register(node)
```

## è®¸å¯è¯

MIT License
