# 评分校验与异常检测指南

## 目录
- 概览
- 多维度交叉验证
- 异常检测机制
- 评分一致性校验
- 数据质量评估
- 修正与再评估流程

## 概览
本参考文档提供评分结果的系统化校验流程和异常检测机制，确保评分的科学性、准确性和可信度，便于后续模块对评分数据进行具体分析。

## 多维度交叉验证

### 验证目标
通过多维度交叉验证，确保评分结果的内在一致性和合理性，识别潜在的评估偏差或错误。

### 验证维度

#### 1. 供给-需求平衡校验
**验证逻辑**：
- 单一供给端事件：检查需求端是否有反向影响（如经济数据同时发布）
- 单一需求端事件：检查供给端是否有反向影响（如OPEC同时发布产量计划）
- 复合事件：检查供给和需求影响是否正确加权

**验证方法**：
```
供给影响 = f1(供给规模, 持续时间, 市场关注度)
需求影响 = f2(需求规模, 持续时间, 市场关注度)
净影响 = 供给影响 + 需求影响

if abs(净影响 - sentiment) > 0.3:
    标记异常："供需平衡校验失败"
```

**异常处理**：
- 重新评估供给和需求的影响权重
- 检查是否存在遗漏的供给或需求因素
- 调整confidence，最多下调0.15

#### 2. 地缘-宏观一致性校验
**验证逻辑**：
- 地缘政治事件应与宏观环境评估一致
- 战争/冲突 → 通常伴随通胀预期上升、经济不确定性
- 制裁缓解 → 通常伴随经济预期改善

**验证方法**：
```
地缘影响 = g1(威胁等级, 持续时间, 市场关注度)
宏观影响 = g2(经济增速, 通胀预期, 货币政策)

一致性判断：
if 地缘影响 > 0 and 宏观影响 < -0.3:
    警告："地缘利多与宏观利空矛盾"
if 地缘影响 < 0 and 宏观影响 > 0.3:
    警告："地缘利空与宏观利多矛盾"
```

**异常处理**：
- 分析矛盾原因（事件优先级、时间错配、影响范围差异）
- 识别主导维度
- 在reasoning中记录矛盾分析

#### 3. 短期-长期影响校验
**验证逻辑**：
- 短期冲击强度应与长期影响方向一致
- 极端短期冲击通常伴随长期结构变化

**验证方法**：
```
短期强度 = h1(事件即时影响, 持续时间<1个月)
长期影响 = h2(事件结构影响, 持续时间>6个月)

方向一致性 = sign(短期强度) == sign(长期影响)

if not 方向一致性:
    警告："短期与长期影响方向不一致"
```

**异常处理**：
- 分析事件性质（短期扰动 vs 结构性变化）
- 区分情绪极性的方向性和冲击强度的时效性
- 重新评估intensity的时间维度

#### 4. 价格预期合理性校验
**验证逻辑**：
- 评分结果应与合理的价格影响范围匹配
- 避免极端评分与价格预期严重脱节

**验证方法**：
```
价格影响预测 = sentiment × intensity × 基准价格波动幅度

预期波动范围：
- 极端事件（intensity>0.8）：20-40%
- 强冲击（0.6<intensity≤0.8）：10-20%
- 中度冲击（0.3<intensity≤0.6）：5-10%
- 轻微冲击（0.0<intensity≤0.3）：0-5%

if 价格影响预测超出预期波动范围:
    警告："价格影响预测异常"
```

**异常处理**：
- 检查sentiment或intensity评分是否过极端
- 验证基准价格波动幅度是否合理
- 调整评分或预期波动范围

### 交叉验证执行流程

#### Step 1: 维度评估
对每个事件执行：
- [ ] 供给-需求平衡校验
- [ ] 地缘-宏观一致性校验
- [ ] 短期-长期影响校验
- [ ] 价格预期合理性校验

#### Step 2: 异常识别
记录所有警告和异常：
- 异常类型
- 异常严重程度（低/中/高）
- 异常描述
- 影响的评分维度

#### Step 3: 置信度调整
根据异常严重程度调整confidence：
- 低度异常：下调0.05-0.1
- 中度异常：下调0.1-0.15
- 高度异常：下调0.15-0.25

#### Step 4: 异常记录
在reasoning的cross_validation字段中记录：
- 执行的验证项
- 发现的异常
- 调整措施
- 调整后的confidence

## 异常检测机制

### 异常类型定义

#### 1. 评分边界异常
**定义**：评分超出合理范围或达到极端值

**检测规则**：
- sentiment = ±1.0 → 标记"极端情绪"
- intensity = 0.0 或 1.0 → 标记"边界强度"
- confidence = 0.0 → 标记"极低置信"

**处理方式**：
- 审查事件描述是否支持极端评分
- 参考历史极端事件的评分
- 在reasoning中解释极端评分的合理性

#### 2. 评分组合异常
**定义**：sentiment、intensity、confidence的组合异常

**检测规则**：
- sentiment极性强（|sentiment|>0.8）但confidence低（<0.5）→ 标记"强情绪弱置信"
- intensity极高（>0.8）但sentiment较弱（|sentiment|<0.3）→ 标记"高强度弱方向"
- confidence极高（>0.8）但intensity极低（<0.2）→ 标记"高置信低影响"

**处理方式**：
- 分析异常原因（信息矛盾、评估者偏差等）
- 重新评估冲突维度
- 调整confidence至合理范围

#### 3. 历史参照异常
**定义**：当前评分与历史相似事件评分差异显著

**检测规则**：
- |当前sentiment - 历史sentiment| > 0.3 → 警告"情绪极性偏离"
- |当前intensity - 历史intensity| > 0.2 → 警告"冲击强度偏离"

**处理方式**：
- 分析历史事件与当前事件的差异（市场环境、事件细节等）
- 判断差异是否合理
- 在reasoning中记录偏离分析

#### 4. 多维度冲突异常
**定义**：不同维度评估结果矛盾

**检测规则**：
- 供给维度利多，需求维度利空，且两者强度均>0.5 → 警告"供需维度强冲突"
- 地缘维度利多，宏观维度利空，且两者强度均>0.5 → 警告"地缘宏观强冲突"

**处理方式**：
- 识别主导维度
- 评估冲突的合理性
- 在reasoning中详细记录冲突分析

### 异常检测执行流程

#### Step 1: 自动检测
执行所有异常检测规则，记录检测到的问题。

#### Step 2: 严重程度评估
对每个检测到的问题评估严重程度：
- **低度**：轻微偏差，不影响主要结论
- **中度**：明显偏差，需关注
- **高度**：严重偏差，需重新评估

#### Step 3: 异常处理
根据严重程度执行：
- **低度**：记录异常，轻微调整confidence（-0.05~ -0.1）
- **中度**：记录异常，调整confidence（-0.1~ -0.2），在reasoning中说明
- **高度**：标记异常，大幅调整confidence（-0.2~ -0.3），考虑重新评估

#### Step 4: 异常汇总
在reasoning的anomalies字段中汇总：
- 异常类型列表
- 严重程度
- 处理措施
- 调整后的confidence

## 评分一致性校验

### 校验目标
确保同一类型事件在不同时间、不同评估者之间保持评分一致性。

### 校验方法

#### 1. 类型一致性校验
**校验逻辑**：同一类型事件应产生相近的评分

**校验方法**：
```
事件类型分类（如：OPEC减产、经济衰退、地缘冲突等）
同类事件评分均值 μ
同类事件评分标准差 σ

if |当前评分 - μ| > 2σ:
    标记"类型一致性异常"
```

**异常处理**：
- 分析当前事件与同类事件的差异
- 判断差异是否合理
- 调整评分或记录特殊原因

#### 2. 时间一致性校验
**校验逻辑**：同一事件在不同评估时间的评分应保持稳定

**校验方法**：
```
记录事件首次评估评分
记录事件更新评估评分

if |更新评分 - 首次评分| > 0.15:
    标记"时间一致性异常"
```

**异常处理**：
- 分析评分变化原因（新信息、市场环境变化）
- 判断变化是否合理
- 在reasoning中记录评分变化

#### 3. 评估者一致性校验
**校验逻辑**：不同评估者对同一事件的评分应基本一致

**校验方法**：
```
多评估者评分：[s1, s2, s3, ...]
评分均值 μ
评分标准差 σ

if σ > 0.15:
    警告"评估者一致性不足"
```

**注意**：此校验适用于有多个评估者并行评估的场景。

### 校验执行时机

- **即时校验**：每次评估后立即执行类型一致性校验
- **定期校验**：每周执行历史评分的时间一致性校验
- **抽样校验**：每月随机抽取事件进行多评估者一致性校验

## 数据质量评估

### 质量维度

#### 1. 完整性
**定义**：评分数据是否包含所有必需字段

**检查项**：
- sentiment（必需，数值，范围[-1, 1]）
- intensity（必需，数值，范围[0, 1]）
- confidence（必需，数值，范围[0, 1]）
- reasoning.event_type（必需，字符串）
- reasoning.sentiment_basis（必需，字符串）
- reasoning.intensity_basis（必需，字符串）
- reasoning.confidence_breakdown（必需，对象）
- reasoning.historical_reference（可选，字符串）
- reasoning.cross_validation（可选，字符串）
- reasoning.anomalies（可选，数组）

#### 2. 准确性
**定义**：评分数据是否符合业务规则和逻辑

**检查项**：
- 所有数值字段在合理范围内
- confidence_breakdown各维度评分在[0, 1]范围内
- confidence_breakdown各维度加权计算与confidence一致
- reasoning中各basis字段非空

#### 3. 一致性
**定义**：评分数据内部逻辑是否一致

**检查项**：
- sentiment方向与sentiment_basis描述一致
- intensity大小与intensity_basis描述一致
- confidence与confidence_breakdown各维度评分一致
- historical_reference与实际评分相近

#### 4. 及时性
**定义**：评分数据是否在事件发生后及时产出

**检查项**：
- 事件发生至评分产出的时间差
- 评分更新与信息更新的时间差

### 质量评分

#### 综合质量评分计算
```
完整性得分 = 通过的完整性检查项 / 总完整性检查项
准确性得分 = 通过的准确性检查项 / 总准确性检查项
一致性得分 = 通过的一致性检查项 / 总一致性检查项
及时性得分 = min(1.0, 24小时 / 实际小时数)

质量得分 = (完整性 × 0.3) + (准确性 × 0.3) + (一致性 × 0.3) + (及时性 × 0.1)
```

#### 质量等级定义
- **优秀**（质量得分≥0.9）：数据质量高，可直接使用
- **良好**（0.7≤质量得分<0.9）：数据质量较好，可用
- **一般**（0.5≤质量得分<0.7）：数据质量一般，需关注
- **较差**（质量得分<0.5）：数据质量差，需改进

## 修正与再评估流程

### 触发条件

出现以下情况时触发修正或再评估：
1. 新信息发布（如事件细节更新、官方数据修正）
2. 市场反应与评分严重背离
3. 多维度交叉验证发现高度异常
4. 质量评分低于0.5
5. 用户反馈评分不合理

### 修正流程

#### Step 1: 信息收集
- 收集新增信息或用户反馈
- 识别信息变化对评分的影响
- 评估信息的可信度和重要性

#### Step 2: 影响分析
- 分析新信息对各评分维度的影响
- 判断是否需要调整sentiment、intensity、confidence
- 评估调整幅度

#### Step 3: 修正实施
- 根据影响分析调整评分
- 更新reasoning中的相关信息
- 记录修正原因和依据

#### Step 4: 重新校验
- 执行多维度交叉验证
- 执行异常检测
- 评估修正后的数据质量

#### Step 5: 修正记录
在reasoning中追加修正记录：
```json
{
  "correction": {
    "timestamp": "修正时间",
    "reason": "修正原因",
    "changes": {
      "old": {"sentiment": 0.8, "intensity": 0.85, "confidence": 0.85},
      "new": {"sentiment": 0.7, "intensity": 0.75, "confidence": 0.8}
    },
    "basis": "修正依据说明"
  }
}
```

### 再评估流程

当需要完全重新评估时（如初始评估错误）：

#### Step 1: 重新收集信息
- 重新梳理事件信息
- 补充缺失的关键信息
- 验证信息的准确性

#### Step 2: 重新执行评估
- 按照标准评估流程重新评估
- 执行完整的交叉验证
- 执行完整的异常检测

#### Step 3: 替换旧评分
- 用新评分替换旧评分
- 标记旧评分为"已作废"
- 在reasoning中记录再评估说明

#### Step 4: 通知相关模块
- 通知使用该评分数据的下游模块
- 提供新旧评分对比
- 说明评分变化的原因

## 评分可信度报告

### 报告内容

每次评分产出的可信度报告应包含：

1. **基础信息**
   - 事件描述
   - 评估时间
   - 评估者

2. **评分结果**
   - sentiment
   - intensity
   - confidence

3. **置信度明细**
   - 信息完整性评分及说明
   - 历史事件匹配度评分及说明
   - 多维度一致性评分及说明
   - 市场预期偏离度评分及说明
   - 评估者经验权重评分及说明
   - 各维度权重配置及说明

4. **交叉验证结果**
   - 执行的验证项
   - 验证通过情况
   - 发现的异常及处理

5. **异常检测报告**
   - 检测到的异常类型
   - 异常严重程度
   - 异常处理措施
   - 对confidence的影响

6. **数据质量评分**
   - 完整性得分
   - 准确性得分
   - 一致性得分
   - 及时性得分
   - 综合质量得分

7. **修正记录**（如有）
   - 修正时间
   - 修正原因
   - 评分变化
   - 修正依据

### 报告格式

```json
{
  "sentiment": 0.8,
  "intensity": 0.85,
  "confidence": 0.85,
  "reasoning": {
    "event_type": "供给端冲击",
    "sentiment_basis": "供给减少100万桶/日，利多情绪明确",
    "intensity_basis": "影响规模占全球约1%，持续数月，市场关注度高",
    "confidence_breakdown": {
      "信息完整性": {
        "score": 0.9,
        "weight": 0.25,
        "explanation": "事件描述极其完整，包含关键要素"
      },
      "历史事件匹配度": {
        "score": 0.9,
        "weight": 0.25,
        "explanation": "与2020年OPEC减产事件高度相似"
      },
      "多维度一致性": {
        "score": 0.85,
        "weight": 0.2,
        "explanation": "供给端明确，需求/地缘/宏观无冲突"
      },
      "市场预期偏离度": {
        "score": 0.8,
        "weight": 0.15,
        "explanation": "与市场预期基本一致"
      },
      "评估者经验权重": {
        "score": 0.8,
        "weight": 0.15,
        "explanation": "对OPEC减产事件有较好理解"
      }
    },
    "historical_reference": "参考2020年OPEC减产事件（sentiment=0.75, intensity=0.7）",
    "cross_validation": {
      "供给需求校验": "通过",
      "地缘宏观校验": "通过",
      "短期长期校验": "通过",
      "价格预期校验": "通过",
      "异常": "无"
    },
    "anomalies": []
  },
  "data_quality": {
    "完整性": 1.0,
    "准确性": 1.0,
    "一致性": 0.95,
    "及时性": 1.0,
    "综合质量得分": 0.985,
    "质量等级": "优秀"
  }
}
```

## 使用建议

### 对后续模块

1. **优先使用高置信度数据**
   - confidence ≥ 0.7：可直接使用
   - 0.5 ≤ confidence < 0.7：谨慎使用，关注异常
   - confidence < 0.5：仅作参考

2. **关注异常标记**
   - 优先处理高严重度异常
   - 分析异常原因
   - 必要时请求重新评估

3. **利用reasoning信息**
   - 了解评分依据
   - 分析各维度得分
   - 理解置信度来源

4. **参考数据质量评分**
   - 优先使用质量等级"优秀"的数据
   - 关注"一般"和"较差"的数据
   - 必要时请求质量改进

### 对评估者

1. **严格执行交叉验证**
   - 每次评估后执行完整的交叉验证
   - 记录验证结果和异常
   - 根据验证结果调整confidence

2. **详细记录评估依据**
   - reasoning字段必须详细
   - 各维度评分必须说明依据
   - 异常情况必须说明

3. **及时处理异常**
   - 发现异常立即处理
   - 必要时重新评估
   - 记录异常处理过程

4. **持续改进**
   - 关注数据质量评分
   - 分析历史异常
   - 优化评估流程
